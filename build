#!/bin/bash
#
# Build a new Python Docker image.
#
# Usage:
#   ./build [--gpu] [--use-cache]
#
# Options:
#   --gpu: Build an image with GPU support.
#   --use-cache: Use layer cache when building a new image.
# 
set -e
set -x

CACHE_FLAG="--no-cache"
IMAGE_TAG="kaggle/python-build"
DOCKERFILE="Dockerfile"

if [[ "$1" == "--gpu" ]]; then
    IMAGE_TAG="kaggle/python-gpu-build"
    DOCKERFILE="gpu.Dockerfile"
    shift
fi

if [[ "$1" ==  "--use-cache" ]]; then
    CACHE_FLAG=""
fi

docker build --rm -t $CACHE_FLAG $IMAGE_TAG -f $DOCKERFILE .
